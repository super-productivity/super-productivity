<div class="habit-tracker-container">
  <div class="navigation-bar">
    <div class="nav-controls">
      <button
        mat-icon-button
        (click)="prevWeek()"
        [matTooltip]="T.F.SIMPLE_COUNTER.HABIT_TRACKER.PREV_WEEK | translate"
      >
        <mat-icon>chevron_left</mat-icon>
      </button>
      <span class="range-label">{{ dateRangeLabel() }}</span>
      <button
        mat-icon-button
        (click)="nextWeek()"
        [matTooltip]="T.F.SIMPLE_COUNTER.HABIT_TRACKER.NEXT_WEEK | translate"
        [disabled]="dayOffset() >= 0"
      >
        <mat-icon>chevron_right</mat-icon>
      </button>
    </div>
    <button
      mat-button
      (click)="resetToToday()"
      class="today-btn"
      [disabled]="dayOffset() === 0"
    >
      {{ T.F.SIMPLE_COUNTER.HABIT_TRACKER.TODAY | translate }}
    </button>
  </div>

  <div class="habit-grid">
    <div class="header-row">
      <div class="habit-label"></div>
      @for (day of days(); track day) {
        <div class="day-header">
          <div class="day-name">{{ parseDateLocal(day) | date: 'EEE' }}</div>
          <div class="day-date">{{ parseDateLocal(day) | date: 'dd' }}</div>
        </div>
      }
    </div>

    @for (counter of simpleCounters(); track counter.id) {
      <div class="habit-row">
        <div
          class="habit-title"
          [matTooltip]="counter.title"
        >
          @if (counter.icon && counter.icon.startsWith(':')) {
            <mat-icon
              [svgIcon]="counter.icon"
              class="habit-icon"
            ></mat-icon>
          } @else if (counter.icon) {
            <mat-icon class="habit-icon">{{ counter.icon }}</mat-icon>
          } @else {
            <mat-icon class="habit-icon">check_box_outline_blank</mat-icon>
          }
          <span class="habit-name">{{ counter.title }}</span>
        </div>
        @for (day of days(); track day) {
          <div
            class="day-cell"
            (click)="onCellClick(counter, day)"
            (contextmenu)="onCellContextMenu($event, counter, day)"
            (mousedown)="onPressStart(counter, day)"
            (mouseup)="onPressEnd()"
            (mouseleave)="onPressEnd()"
            (touchstart)="onPressStart(counter, day)"
            (touchend)="onPressEnd()"
          >
            <div
              class="check-circle"
              [class.is-done]="getVal(counter, day) >= (counter.streakMinValue || 1)"
            >
              @if (
                getProgress(counter, day) > 0 &&
                getProgress(counter, day) < 100 &&
                !isSimpleCompletion(counter)
              ) {
                <svg
                  class="progress-ring"
                  viewBox="0 0 32 32"
                >
                  <circle
                    class="progress-ring-circle"
                    stroke="currentColor"
                    stroke-width="2"
                    fill="transparent"
                    r="14"
                    cx="16"
                    cy="16"
                    [style.stroke-dasharray]="'88 88'"
                    [style.stroke-dashoffset]="
                      88 - (88 * getProgress(counter, day)) / 100
                    "
                  ></circle>
                </svg>
              }
              @if (isSimpleCompletion(counter) && getVal(counter, day) > 0) {
                <mat-icon>check</mat-icon>
              } @else if (getDisplayValue(counter, day)) {
                <span class="value-text">{{ getDisplayValue(counter, day) }}</span>
              }
            </div>
          </div>
        }
      </div>
    }
  </div>
</div>
